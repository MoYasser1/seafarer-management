<div class="app-page">
  <div class="list-container">

    <header class="page-header">
      <div class="page-header__content">
        <h1 class="page-header__title">
          <span class="page-header__icon">ðŸš¢</span>
          Mariner Management
        </h1>
        <p class="page-header__subtitle">
          Total Seafarers: <strong>{{ filteredSeafarers.length }}</strong>
        </p>
      </div>
      <button (click)="logout()" class="btn btn--danger btn--outline">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="btn__icon">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
          <polyline points="16 17 21 12 16 7"></polyline>
          <line x1="21" y1="12" x2="9" y2="12"></line>
        </svg>
        <span>Log Out</span>
      </button>
    </header>

    <div class="toolbar card">
      <div class="toolbar__search">
        <div class="search-input-wrapper">
          <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
          <input type="text"
                 [(ngModel)]="searchText"
                 (input)="onSearch()"
                 placeholder="Search by Name, Code, or Nationality..."
                 class="form-input search-input">
        </div>
      </div>
      <div class="toolbar__actions">
        <button (click)="addSeafarer()" class="btn btn--primary">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="btn__icon">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Add New Seafarer
        </button>
      </div>
    </div>

    <div *ngIf="isLoading" class="state-container">
      <div class="spinner"></div>
      <p class="state-text">Loading seafarers directory...</p>
    </div>

    <div *ngIf="errorMessage" class="state-container state-container--error">
      <div class="error-box">
        <h3 class="error-box__title">System Error</h3>
        <p>{{ errorMessage }}</p>
        <button (click)="loadSeafarers()" class="btn btn--secondary btn--sm">Retry Connection</button>
      </div>
    </div>

    <ng-container *ngIf="!isLoading && !errorMessage">

      <div *ngIf="filteredSeafarers.length === 0" class="state-container">
        <div class="empty-icon">ðŸ“­</div>
        <h3 class="empty-title">No Seafarers Found</h3>
        <p class="empty-text">Try adjusting your search or add a new seafarer.</p>
      </div>

      <div *ngIf="filteredSeafarers.length > 0" class="card table-card desktop-only">
        <div class="table-responsive">
          <table class="data-table">
            <thead>
              <tr>
                <th>Code</th>
                <th>Employee Name</th>
                <th>Job Title</th>
                <th>Sponsor</th>
                <th>Nationality</th>
                <th>Passport Info</th>
                <th>Visa Expiry</th>
                <th class="text-center">Status</th>
                <th class="text-center">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let seafarer of filteredSeafarers">
                <td class="font-mono text-accent">{{ seafarer.EmployeeCode || '-' }}</td>
                <td class="font-medium">{{ seafarer.EmployeeName || '-' }}</td>
                <td class="text-muted">{{ seafarer.JobName || '-' }}</td>
                <td class="text-muted">{{ seafarer.SponsorName || '-' }}</td>
                <td>{{ seafarer.Nationality || '-' }}</td>
                <td>
                  <div class="cell-group">
                    <span>{{ seafarer.PassportNumber || '-' }}</span>
                    <small class="text-muted">Exp: {{ formatDate(seafarer.IDExPiryDate || seafarer.PassportExpireDate) }}</small>
                  </div>
                </td>
                <td>{{ formatDate(seafarer.VisaExpiryDate) }}</td>
                <td class="text-center">
                  <button (click)="toggleStatus(seafarer)"
                          class="badge"
                          [class.badge--success]="seafarer.IsActive"
                          [class.badge--danger]="!seafarer.IsActive">
                    {{ seafarer.IsActive ? 'Active' : 'Inactive' }}
                  </button>
                </td>
                <td class="text-center">
                  <button (click)="editSeafarer(seafarer.Id!)" class="btn-icon-only" title="Edit Seafarer">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="table-footer">
          Showing {{ filteredSeafarers.length }} records
        </div>
      </div>

      <div *ngIf="filteredSeafarers.length > 0" class="mobile-list mobile-only">
        <div *ngFor="let seafarer of filteredSeafarers" class="card mobile-card">
          <div class="mobile-card__header">
            <div>
              <h3 class="mobile-card__title">{{ seafarer.EmployeeName || 'N/A' }}</h3>
              <span class="mobile-card__subtitle">{{ seafarer.JobName || '-' }}</span>
            </div>
            <button (click)="toggleStatus(seafarer)"
                    class="badge badge--sm"
                    [class.badge--success]="seafarer.IsActive"
                    [class.badge--danger]="!seafarer.IsActive">
              {{ seafarer.IsActive ? 'Active' : 'Inactive' }}
            </button>
          </div>

          <div class="mobile-card__body">
            <div class="info-row">
              <span class="info-label">Code:</span>
              <span class="info-value font-mono">{{ seafarer.EmployeeCode || '-' }}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Nationality:</span>
              <span class="info-value">{{ seafarer.Nationality || '-' }}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Passport:</span>
              <span class="info-value">{{ seafarer.PassportNumber || '-' }}</span>
            </div>
          </div>

          <div class="mobile-card__actions">
            <button (click)="editSeafarer(seafarer.Id!)" class="btn btn--secondary btn--full">
              Edit Details
            </button>
          </div>
        </div>
      </div>

    </ng-container>

  </div>
</div>
